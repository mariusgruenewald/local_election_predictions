{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "\"\"\" The attempt to construct a linear regression, regularized regression and a neural network.\n",
    "    Hereby, I'm aiming at finding an overall bound of confidence for local election prediction.\"\"\"\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 144,
   "metadata": {},
   "outputs": [],
   "source": [
    "\"\"\" First, we start with a linear regression (Lower hanging fruits are always harvested first)\n",
    "Start by importing packages\"\"\"\n",
    "\n",
    "from sklearn.linear_model import LinearRegression\n",
    "from sklearn.linear_model import SGDRegressor\n",
    "from sklearn.model_selection import train_test_split\n",
    "import pandas as pd\n",
    "import statsmodels.api as sm"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 148,
   "metadata": {},
   "outputs": [],
   "source": [
    "# Start by importing data - one with incumbent(clean) the other without\n",
    "dataframe_1 = pd.read_excel(r'C:\\Users\\mariu\\Desktop\\Project\\Historical Data\\Data_mai.xlsx')\n",
    "dataframe = dataframe_1.dropna().reset_index()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 152,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(array([-2.89802525e+02,  3.95741578e+00,  6.92920387e+03,  1.91920291e+02,\n",
       "        -3.70119430e+02,  7.32973320e+02, -5.33469840e+00, -2.52020746e+03,\n",
       "         4.51812939e-05,  4.74663784e+02,  1.80357285e+02,  8.74216644e+01,\n",
       "        -1.06158047e+03,  3.68028839e-02,  8.88318626e+04, -4.63282065e+04,\n",
       "        -3.33488552e+04, -2.88540616e+04, -2.41948982e+04, -6.69987552e+04,\n",
       "        -4.28091611e+04, -6.95047897e+04, -2.23496157e+09,  2.81149477e+07,\n",
       "        -2.81151029e+07, -2.81145478e+07,  2.23496210e+09,  2.23496367e+09,\n",
       "         2.23496226e+09,  2.23496288e+09,  2.23496212e+09,  2.23496277e+09,\n",
       "         2.23496150e+09, -2.81142707e+07, -2.81142670e+07, -2.81149547e+07,\n",
       "        -2.81141694e+07, -2.81148022e+07, -1.66590049e+09, -1.66591413e+09,\n",
       "        -1.66589670e+09, -1.66592123e+09, -1.66587879e+09, -5.33843913e+09,\n",
       "        -1.66593218e+09, -1.66593327e+09, -2.85963009e+08, -2.85963045e+08,\n",
       "        -2.85963184e+08, -2.85963309e+08, -2.85963324e+08, -2.85961731e+08,\n",
       "        -2.85962874e+08,  2.85963192e+08, -2.64281317e+09, -2.64287573e+09,\n",
       "        -2.64285713e+09, -2.64288982e+09, -2.64290634e+09, -2.64291720e+09,\n",
       "        -2.64290490e+09,  2.64285767e+09,  8.01210982e+10, -8.01210692e+10,\n",
       "        -8.01209534e+10, -8.01212689e+10, -8.01211684e+10, -8.01211759e+10,\n",
       "        -8.01210090e+10, -8.01209806e+10]),\n",
       " 1665887989.2929478,\n",
       " <bound method RegressorMixin.score of LinearRegression(copy_X=True, fit_intercept=True, n_jobs=None,\n",
       "          normalize=False)>)"
      ]
     },
     "execution_count": 152,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Declare X and Y variable\n",
    "X = dataframe[['place_list', 'place_list_sq', 'incumbent', 'woman', 'woman_2014', 'doctor', \n",
    "               'federal_election', 'artistocracy', 'google', 'google_zero', 'google_b1000', 'google_b100', \n",
    "               'google_million', 'population', 'share_students', 'CDU_share_students', 'SPD_share_students', 'FW_share_students',\n",
    "               'local_list_share_students', 'Grüne_share_students', 'FDP_share_students', 'Linke_share_students', 'unemployment', \n",
    "               'share_old', 'FW_share_old', 'local_list_share_old', 'CDU_unemployment', 'SPD_unemployment', 'Grüne_unemployment', \n",
    "               'FDP_unemployment', 'FW_unemployment', 'local_list_unemployment',\n",
    "               'Linke_unemployment', 'CDU_share_old', 'SPD_share_old', 'Grüne_share_old', 'FDP_share_old',\n",
    "               'Linke_share_old', 'CDU', 'SPD', 'Linke', 'FDP', 'Grüne', 'AfD', 'FW', 'local_list', 'CDU_share_youth', \n",
    "               'SPD_share_youth', 'Grüne_share_youth', 'FDP_share_youth', 'Linke_share_youth', 'FW_share_youth', 'local_list_share_youth',\n",
    "               'share_youth', 'CDU_share_migrants', 'SPD_share_migrants', 'Grüne_share_migrants', 'FW_share_migrants', \n",
    "               'local_list_share_migrants', 'FDP_share_migrants', 'Linke_share_migrants', 'share_migrants', 'share_pupils',\n",
    "               'FW_share_pupils', 'local_list_share_pupils', 'CDU_share_pupils', 'SPD_share_pupils', 'Grüne_share_pupils', \n",
    "               'FDP_share_pupils', 'Linke_share_pupils',\n",
    "              ]]\n",
    "y = dataframe['votes']\n",
    "\n",
    "# Split dataset, not necessary for Linear regression, but for machine learning.\n",
    "\n",
    "X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=123)\n",
    "\n",
    "# Perform linear regression with the training data\n",
    "lin_reg = LinearRegression()\n",
    "lin_reg = lin_reg.fit(X_train,y_train)\n",
    "\n",
    "# Check out coefficients\n",
    "lin_reg.coef_, lin_reg.intercept_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 151,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "0.6484821014684394"
      ]
     },
     "execution_count": 151,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Check the accuracy of the model\n",
    "lin_reg.score(X_test,y_test)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 157,
   "metadata": {},
   "outputs": [],
   "source": [
    "\"Make predictions and see and how well we do\"\n",
    "\n",
    "dataframe_2019 = pd.read_excel(r'C:\\Users\\mariu\\Desktop\\Project\\2019_Data\\Data_BW_2019.xlsx')\n",
    "dataframe_2019 = dataframe_1.dropna().reset_index()\n",
    "X_2019 = dataframe_2019[['place_list', 'place_list_sq', 'incumbent', 'woman', 'woman_2014', 'doctor', \n",
    "               'federal_election', 'artistocracy', 'google', 'google_zero', 'google_b1000', 'google_b100', \n",
    "               'google_million', 'population', 'share_students', 'CDU_share_students', 'SPD_share_students', 'FW_share_students',\n",
    "               'local_list_share_students', 'Grüne_share_students', 'FDP_share_students', 'Linke_share_students', 'unemployment', \n",
    "               'share_old', 'FW_share_old', 'local_list_share_old', 'CDU_unemployment', 'SPD_unemployment', 'Grüne_unemployment', \n",
    "               'FDP_unemployment', 'FW_unemployment', 'local_list_unemployment',\n",
    "               'Linke_unemployment', 'CDU_share_old', 'SPD_share_old', 'Grüne_share_old', 'FDP_share_old',\n",
    "               'Linke_share_old', 'CDU', 'SPD', 'Linke', 'FDP', 'Grüne', 'AfD', 'FW', 'local_list', 'CDU_share_youth', \n",
    "               'SPD_share_youth', 'Grüne_share_youth', 'FDP_share_youth', 'Linke_share_youth', 'FW_share_youth', 'local_list_share_youth',\n",
    "               'share_youth', 'CDU_share_migrants', 'SPD_share_migrants', 'Grüne_share_migrants', 'FW_share_migrants', \n",
    "               'local_list_share_migrants', 'FDP_share_migrants', 'Linke_share_migrants', 'share_migrants', 'share_pupils',\n",
    "               'FW_share_pupils', 'local_list_share_pupils', 'CDU_share_pupils', 'SPD_share_pupils', 'Grüne_share_pupils', \n",
    "               'FDP_share_pupils', 'Linke_share_pupils',\n",
    "              ]]\n",
    "y_pred = lin_reg.predict(X_2019)\n",
    "dataframe_2019['Linear_prediction'] = y_pred\n",
    "dataframe_2019.to_excel(r'C:\\Users\\mariu\\Desktop\\Project\\Linear_predictions_whole_data.xlsx')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 154,
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "C:\\Users\\mariu\\Anaconda3\\lib\\site-packages\\scipy\\stats\\_distn_infrastructure.py:879: RuntimeWarning: invalid value encountered in greater\n",
      "  return (self.a < x) & (x < self.b)\n",
      "C:\\Users\\mariu\\Anaconda3\\lib\\site-packages\\scipy\\stats\\_distn_infrastructure.py:879: RuntimeWarning: invalid value encountered in less\n",
      "  return (self.a < x) & (x < self.b)\n",
      "C:\\Users\\mariu\\Anaconda3\\lib\\site-packages\\scipy\\stats\\_distn_infrastructure.py:1821: RuntimeWarning: invalid value encountered in less_equal\n",
      "  cond2 = cond0 & (x <= self.a)\n"
     ]
    },
    {
     "data": {
      "text/html": [
       "<table class=\"simpletable\">\n",
       "<caption>OLS Regression Results</caption>\n",
       "<tr>\n",
       "  <th>Dep. Variable:</th>          <td>votes</td>      <th>  R-squared:         </th> <td>   0.639</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.636</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>     nan</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Date:</th>             <td>Thu, 23 May 2019</td> <th>  Prob (F-statistic):</th>  <td>   nan</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Time:</th>                 <td>15:52:03</td>     <th>  Log-Likelihood:    </th> <td> -76686.</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>No. Observations:</th>      <td>  7669</td>      <th>  AIC:               </th> <td>1.535e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Df Residuals:</th>          <td>  7599</td>      <th>  BIC:               </th> <td>1.540e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Df Model:</th>              <td>    69</td>      <th>                     </th>     <td> </td>    \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Covariance Type:</th>         <td>HC3</td>       <th>                     </th>     <td> </td>    \n",
       "</tr>\n",
       "</table>\n",
       "<table class=\"simpletable\">\n",
       "<tr>\n",
       "              <td></td>                 <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>place_list</th>                <td> -315.0983</td> <td>   19.422</td> <td>  -16.224</td> <td> 0.000</td> <td> -353.165</td> <td> -277.032</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>place_list_sq</th>             <td>    4.3823</td> <td>    0.383</td> <td>   11.436</td> <td> 0.000</td> <td>    3.631</td> <td>    5.133</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>incumbent</th>                 <td> 6722.5890</td> <td>  423.265</td> <td>   15.883</td> <td> 0.000</td> <td> 5893.005</td> <td> 7552.173</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>woman</th>                     <td>  254.7156</td> <td>  182.243</td> <td>    1.398</td> <td> 0.162</td> <td> -102.474</td> <td>  611.905</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>woman_2014</th>                <td> -275.6322</td> <td>  220.169</td> <td>   -1.252</td> <td> 0.211</td> <td> -707.155</td> <td>  155.891</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>doctor</th>                    <td>  670.4055</td> <td>  166.765</td> <td>    4.020</td> <td> 0.000</td> <td>  343.552</td> <td>  997.259</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>federal_election</th>          <td>    2.9012</td> <td>   40.585</td> <td>    0.071</td> <td> 0.943</td> <td>  -76.644</td> <td>   82.447</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>artistocracy</th>              <td>-2627.7949</td> <td> 2023.733</td> <td>   -1.298</td> <td> 0.194</td> <td>-6594.238</td> <td> 1338.649</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>google</th>                    <td> 3.898e-05</td> <td> 2.58e-05</td> <td>    1.511</td> <td> 0.131</td> <td>-1.16e-05</td> <td> 8.96e-05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>google_zero</th>               <td>  294.1536</td> <td>  219.017</td> <td>    1.343</td> <td> 0.179</td> <td> -135.112</td> <td>  723.419</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>google_b1000</th>              <td>  216.2737</td> <td>  167.419</td> <td>    1.292</td> <td> 0.196</td> <td> -111.861</td> <td>  544.408</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>google_b100</th>               <td>  128.0147</td> <td>  151.528</td> <td>    0.845</td> <td> 0.398</td> <td> -168.975</td> <td>  425.004</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>google_million</th>            <td> -119.6671</td> <td>  612.560</td> <td>   -0.195</td> <td> 0.845</td> <td>-1320.263</td> <td> 1080.928</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>population</th>                <td>    0.0356</td> <td>    0.001</td> <td>   25.202</td> <td> 0.000</td> <td>    0.033</td> <td>    0.038</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>share_students</th>            <td> 9.119e+04</td> <td> 4965.036</td> <td>   18.366</td> <td> 0.000</td> <td> 8.15e+04</td> <td> 1.01e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>CDU_share_students</th>        <td> -4.92e+04</td> <td> 1.12e+04</td> <td>   -4.391</td> <td> 0.000</td> <td>-7.12e+04</td> <td>-2.72e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPD_share_students</th>        <td>-4.341e+04</td> <td> 8813.292</td> <td>   -4.926</td> <td> 0.000</td> <td>-6.07e+04</td> <td>-2.61e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FW_share_students</th>         <td>-3.154e+04</td> <td> 6603.028</td> <td>   -4.776</td> <td> 0.000</td> <td>-4.45e+04</td> <td>-1.86e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>local_list_share_students</th> <td>-2.701e+04</td> <td> 6221.649</td> <td>   -4.341</td> <td> 0.000</td> <td>-3.92e+04</td> <td>-1.48e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Grüne_share_students</th>      <td>-6.737e+04</td> <td> 1.13e+04</td> <td>   -5.949</td> <td> 0.000</td> <td>-8.96e+04</td> <td>-4.52e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FDP_share_students</th>        <td>-4.098e+04</td> <td> 6304.327</td> <td>   -6.500</td> <td> 0.000</td> <td>-5.33e+04</td> <td>-2.86e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Linke_share_students</th>      <td>-7.225e+04</td> <td> 5862.288</td> <td>  -12.324</td> <td> 0.000</td> <td>-8.37e+04</td> <td>-6.08e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>unemployment</th>              <td>-9.896e+04</td> <td> 5267.580</td> <td>  -18.787</td> <td> 0.000</td> <td>-1.09e+05</td> <td>-8.86e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>share_old</th>                 <td> 8706.4918</td> <td>  326.380</td> <td>   26.676</td> <td> 0.000</td> <td> 8066.798</td> <td> 9346.185</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FW_share_old</th>              <td>-8855.9589</td> <td>  333.196</td> <td>  -26.579</td> <td> 0.000</td> <td>-9509.010</td> <td>-8202.908</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>local_list_share_old</th>      <td>-8292.5189</td> <td>  330.069</td> <td>  -25.124</td> <td> 0.000</td> <td>-8939.441</td> <td>-7645.596</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>CDU_unemployment</th>          <td> 9.975e+04</td> <td> 5249.084</td> <td>   19.004</td> <td> 0.000</td> <td> 8.95e+04</td> <td>  1.1e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPD_unemployment</th>          <td> 1.011e+05</td> <td> 5274.182</td> <td>   19.165</td> <td> 0.000</td> <td> 9.07e+04</td> <td> 1.11e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Grüne_unemployment</th>        <td> 9.959e+04</td> <td> 5258.716</td> <td>   18.937</td> <td> 0.000</td> <td> 8.93e+04</td> <td>  1.1e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FDP_unemployment</th>          <td> 1.005e+05</td> <td> 5279.071</td> <td>   19.038</td> <td> 0.000</td> <td> 9.02e+04</td> <td> 1.11e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FW_unemployment</th>           <td> 9.961e+04</td> <td> 5277.497</td> <td>   18.875</td> <td> 0.000</td> <td> 8.93e+04</td> <td>  1.1e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>local_list_unemployment</th>   <td> 1.004e+05</td> <td> 5281.973</td> <td>   19.000</td> <td> 0.000</td> <td>    9e+04</td> <td> 1.11e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Linke_unemployment</th>        <td> 9.908e+04</td> <td> 5273.846</td> <td>   18.788</td> <td> 0.000</td> <td> 8.87e+04</td> <td> 1.09e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>CDU_share_old</th>             <td>-8134.4760</td> <td>  364.266</td> <td>  -22.331</td> <td> 0.000</td> <td>-8848.424</td> <td>-7420.528</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPD_share_old</th>             <td>-8058.1946</td> <td>  339.207</td> <td>  -23.756</td> <td> 0.000</td> <td>-8723.029</td> <td>-7393.360</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Grüne_share_old</th>           <td>-8704.3904</td> <td>  365.101</td> <td>  -23.841</td> <td> 0.000</td> <td>-9419.975</td> <td>-7988.806</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FDP_share_old</th>             <td>-7927.4558</td> <td>  325.334</td> <td>  -24.367</td> <td> 0.000</td> <td>-8565.098</td> <td>-7289.813</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Linke_share_old</th>           <td>-8634.5082</td> <td>  326.917</td> <td>  -26.412</td> <td> 0.000</td> <td>-9275.254</td> <td>-7993.763</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>CDU</th>                       <td> -1.03e+04</td> <td> 7277.597</td> <td>   -1.416</td> <td> 0.157</td> <td>-2.46e+04</td> <td> 3959.900</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPD</th>                       <td>-2.004e+04</td> <td> 5872.438</td> <td>   -3.412</td> <td> 0.001</td> <td>-3.15e+04</td> <td>-8527.788</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Linke</th>                     <td>-8261.5025</td> <td> 3130.082</td> <td>   -2.639</td> <td> 0.008</td> <td>-1.44e+04</td> <td>-2126.654</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FDP</th>                       <td>-3.567e+04</td> <td> 3565.686</td> <td>  -10.003</td> <td> 0.000</td> <td>-4.27e+04</td> <td>-2.87e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Grüne</th>                     <td> 7397.7039</td> <td> 8336.875</td> <td>    0.887</td> <td> 0.375</td> <td>-8942.270</td> <td> 2.37e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>AfD</th>                       <td>-2.246e+05</td> <td> 1.25e+04</td> <td>  -18.032</td> <td> 0.000</td> <td>-2.49e+05</td> <td>   -2e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FW</th>                        <td>-4.275e+04</td> <td> 3577.860</td> <td>  -11.949</td> <td> 0.000</td> <td>-4.98e+04</td> <td>-3.57e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>local_list</th>                <td>-4.613e+04</td> <td> 3263.846</td> <td>  -14.135</td> <td> 0.000</td> <td>-5.25e+04</td> <td>-3.97e+04</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>CDU_share_youth</th>           <td>  371.8702</td> <td> 1010.773</td> <td>    0.368</td> <td> 0.713</td> <td>-1609.208</td> <td> 2352.949</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPD_share_youth</th>           <td>  161.3276</td> <td> 1002.178</td> <td>    0.161</td> <td> 0.872</td> <td>-1802.904</td> <td> 2125.560</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Grüne_share_youth</th>         <td>  187.0152</td> <td> 1021.176</td> <td>    0.183</td> <td> 0.855</td> <td>-1814.454</td> <td> 2188.484</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FDP_share_youth</th>           <td>   44.4216</td> <td>  999.599</td> <td>    0.044</td> <td> 0.965</td> <td>-1914.757</td> <td> 2003.600</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Linke_share_youth</th>         <td>   89.4694</td> <td>  998.823</td> <td>    0.090</td> <td> 0.929</td> <td>-1868.188</td> <td> 2047.126</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FW_share_youth</th>            <td> 1588.7776</td> <td> 1014.120</td> <td>    1.567</td> <td> 0.117</td> <td> -398.861</td> <td> 3576.417</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>local_list_share_youth</th>    <td>  468.6532</td> <td> 1001.629</td> <td>    0.468</td> <td> 0.640</td> <td>-1494.504</td> <td> 2431.810</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>share_youth</th>               <td> -168.0637</td> <td>  994.350</td> <td>   -0.169</td> <td> 0.866</td> <td>-2116.954</td> <td> 1780.827</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>CDU_share_migrants</th>        <td>-3.016e+05</td> <td>  2.1e+04</td> <td>  -14.382</td> <td> 0.000</td> <td>-3.43e+05</td> <td> -2.6e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPD_share_migrants</th>        <td> -3.61e+05</td> <td> 1.82e+04</td> <td>  -19.789</td> <td> 0.000</td> <td>-3.97e+05</td> <td>-3.25e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Grüne_share_migrants</th>      <td>-3.297e+05</td> <td> 2.11e+04</td> <td>  -15.605</td> <td> 0.000</td> <td>-3.71e+05</td> <td>-2.88e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FW_share_migrants</th>         <td>-3.775e+05</td> <td> 1.75e+04</td> <td>  -21.515</td> <td> 0.000</td> <td>-4.12e+05</td> <td>-3.43e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>local_list_share_migrants</th> <td>-3.888e+05</td> <td> 1.73e+04</td> <td>  -22.441</td> <td> 0.000</td> <td>-4.23e+05</td> <td>-3.55e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FDP_share_migrants</th>        <td>-3.975e+05</td> <td> 1.73e+04</td> <td>  -22.949</td> <td> 0.000</td> <td>-4.31e+05</td> <td>-3.64e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Linke_share_migrants</th>      <td> -3.87e+05</td> <td> 1.75e+04</td> <td>  -22.132</td> <td> 0.000</td> <td>-4.21e+05</td> <td>-3.53e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>share_migrants</th>            <td>   3.4e+05</td> <td> 1.65e+04</td> <td>   20.627</td> <td> 0.000</td> <td> 3.08e+05</td> <td> 3.72e+05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>share_pupils</th>              <td> 4.884e+06</td> <td> 1.91e+05</td> <td>   25.537</td> <td> 0.000</td> <td> 4.51e+06</td> <td> 5.26e+06</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FW_share_pupils</th>           <td>-4.851e+06</td> <td>  1.9e+05</td> <td>  -25.513</td> <td> 0.000</td> <td>-5.22e+06</td> <td>-4.48e+06</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>local_list_share_pupils</th>   <td>-4.736e+06</td> <td> 1.88e+05</td> <td>  -25.144</td> <td> 0.000</td> <td>-5.11e+06</td> <td>-4.37e+06</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>CDU_share_pupils</th>          <td>-5.053e+06</td> <td> 1.93e+05</td> <td>  -26.221</td> <td> 0.000</td> <td>-5.43e+06</td> <td>-4.68e+06</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>SPD_share_pupils</th>          <td>-4.946e+06</td> <td>  1.9e+05</td> <td>  -26.091</td> <td> 0.000</td> <td>-5.32e+06</td> <td>-4.57e+06</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Grüne_share_pupils</th>        <td> -4.96e+06</td> <td> 1.92e+05</td> <td>  -25.785</td> <td> 0.000</td> <td>-5.34e+06</td> <td>-4.58e+06</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>FDP_share_pupils</th>          <td>-4.787e+06</td> <td> 1.88e+05</td> <td>  -25.463</td> <td> 0.000</td> <td>-5.16e+06</td> <td>-4.42e+06</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Linke_share_pupils</th>        <td> -4.77e+06</td> <td> 1.89e+05</td> <td>  -25.283</td> <td> 0.000</td> <td>-5.14e+06</td> <td> -4.4e+06</td>\n",
       "</tr>\n",
       "</table>\n",
       "<table class=\"simpletable\">\n",
       "<tr>\n",
       "  <th>Omnibus:</th>       <td>5076.590</td> <th>  Durbin-Watson:     </th>  <td>   0.826</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>335346.676</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Skew:</th>           <td> 2.461</td>  <th>  Prob(JB):          </th>  <td>    0.00</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Kurtosis:</th>       <td>35.019</td>  <th>  Cond. No.          </th>  <td>6.07e+10</td> \n",
       "</tr>\n",
       "</table><br/><br/>Warnings:<br/>[1] Standard Errors are heteroscedasticity robust (HC3)<br/>[2] The condition number is large, 6.07e+10. This might indicate that there are<br/>strong multicollinearity or other numerical problems."
      ],
      "text/plain": [
       "<class 'statsmodels.iolib.summary.Summary'>\n",
       "\"\"\"\n",
       "                            OLS Regression Results                            \n",
       "==============================================================================\n",
       "Dep. Variable:                  votes   R-squared:                       0.639\n",
       "Model:                            OLS   Adj. R-squared:                  0.636\n",
       "Method:                 Least Squares   F-statistic:                       nan\n",
       "Date:                Thu, 23 May 2019   Prob (F-statistic):                nan\n",
       "Time:                        15:52:03   Log-Likelihood:                -76686.\n",
       "No. Observations:                7669   AIC:                         1.535e+05\n",
       "Df Residuals:                    7599   BIC:                         1.540e+05\n",
       "Df Model:                          69                                         \n",
       "Covariance Type:                  HC3                                         \n",
       "=============================================================================================\n",
       "                                coef    std err          z      P>|z|      [0.025      0.975]\n",
       "---------------------------------------------------------------------------------------------\n",
       "place_list                 -315.0983     19.422    -16.224      0.000    -353.165    -277.032\n",
       "place_list_sq                 4.3823      0.383     11.436      0.000       3.631       5.133\n",
       "incumbent                  6722.5890    423.265     15.883      0.000    5893.005    7552.173\n",
       "woman                       254.7156    182.243      1.398      0.162    -102.474     611.905\n",
       "woman_2014                 -275.6322    220.169     -1.252      0.211    -707.155     155.891\n",
       "doctor                      670.4055    166.765      4.020      0.000     343.552     997.259\n",
       "federal_election              2.9012     40.585      0.071      0.943     -76.644      82.447\n",
       "artistocracy              -2627.7949   2023.733     -1.298      0.194   -6594.238    1338.649\n",
       "google                     3.898e-05   2.58e-05      1.511      0.131   -1.16e-05    8.96e-05\n",
       "google_zero                 294.1536    219.017      1.343      0.179    -135.112     723.419\n",
       "google_b1000                216.2737    167.419      1.292      0.196    -111.861     544.408\n",
       "google_b100                 128.0147    151.528      0.845      0.398    -168.975     425.004\n",
       "google_million             -119.6671    612.560     -0.195      0.845   -1320.263    1080.928\n",
       "population                    0.0356      0.001     25.202      0.000       0.033       0.038\n",
       "share_students             9.119e+04   4965.036     18.366      0.000    8.15e+04    1.01e+05\n",
       "CDU_share_students         -4.92e+04   1.12e+04     -4.391      0.000   -7.12e+04   -2.72e+04\n",
       "SPD_share_students        -4.341e+04   8813.292     -4.926      0.000   -6.07e+04   -2.61e+04\n",
       "FW_share_students         -3.154e+04   6603.028     -4.776      0.000   -4.45e+04   -1.86e+04\n",
       "local_list_share_students -2.701e+04   6221.649     -4.341      0.000   -3.92e+04   -1.48e+04\n",
       "Grüne_share_students      -6.737e+04   1.13e+04     -5.949      0.000   -8.96e+04   -4.52e+04\n",
       "FDP_share_students        -4.098e+04   6304.327     -6.500      0.000   -5.33e+04   -2.86e+04\n",
       "Linke_share_students      -7.225e+04   5862.288    -12.324      0.000   -8.37e+04   -6.08e+04\n",
       "unemployment              -9.896e+04   5267.580    -18.787      0.000   -1.09e+05   -8.86e+04\n",
       "share_old                  8706.4918    326.380     26.676      0.000    8066.798    9346.185\n",
       "FW_share_old              -8855.9589    333.196    -26.579      0.000   -9509.010   -8202.908\n",
       "local_list_share_old      -8292.5189    330.069    -25.124      0.000   -8939.441   -7645.596\n",
       "CDU_unemployment           9.975e+04   5249.084     19.004      0.000    8.95e+04     1.1e+05\n",
       "SPD_unemployment           1.011e+05   5274.182     19.165      0.000    9.07e+04    1.11e+05\n",
       "Grüne_unemployment         9.959e+04   5258.716     18.937      0.000    8.93e+04     1.1e+05\n",
       "FDP_unemployment           1.005e+05   5279.071     19.038      0.000    9.02e+04    1.11e+05\n",
       "FW_unemployment            9.961e+04   5277.497     18.875      0.000    8.93e+04     1.1e+05\n",
       "local_list_unemployment    1.004e+05   5281.973     19.000      0.000       9e+04    1.11e+05\n",
       "Linke_unemployment         9.908e+04   5273.846     18.788      0.000    8.87e+04    1.09e+05\n",
       "CDU_share_old             -8134.4760    364.266    -22.331      0.000   -8848.424   -7420.528\n",
       "SPD_share_old             -8058.1946    339.207    -23.756      0.000   -8723.029   -7393.360\n",
       "Grüne_share_old           -8704.3904    365.101    -23.841      0.000   -9419.975   -7988.806\n",
       "FDP_share_old             -7927.4558    325.334    -24.367      0.000   -8565.098   -7289.813\n",
       "Linke_share_old           -8634.5082    326.917    -26.412      0.000   -9275.254   -7993.763\n",
       "CDU                        -1.03e+04   7277.597     -1.416      0.157   -2.46e+04    3959.900\n",
       "SPD                       -2.004e+04   5872.438     -3.412      0.001   -3.15e+04   -8527.788\n",
       "Linke                     -8261.5025   3130.082     -2.639      0.008   -1.44e+04   -2126.654\n",
       "FDP                       -3.567e+04   3565.686    -10.003      0.000   -4.27e+04   -2.87e+04\n",
       "Grüne                      7397.7039   8336.875      0.887      0.375   -8942.270    2.37e+04\n",
       "AfD                       -2.246e+05   1.25e+04    -18.032      0.000   -2.49e+05      -2e+05\n",
       "FW                        -4.275e+04   3577.860    -11.949      0.000   -4.98e+04   -3.57e+04\n",
       "local_list                -4.613e+04   3263.846    -14.135      0.000   -5.25e+04   -3.97e+04\n",
       "CDU_share_youth             371.8702   1010.773      0.368      0.713   -1609.208    2352.949\n",
       "SPD_share_youth             161.3276   1002.178      0.161      0.872   -1802.904    2125.560\n",
       "Grüne_share_youth           187.0152   1021.176      0.183      0.855   -1814.454    2188.484\n",
       "FDP_share_youth              44.4216    999.599      0.044      0.965   -1914.757    2003.600\n",
       "Linke_share_youth            89.4694    998.823      0.090      0.929   -1868.188    2047.126\n",
       "FW_share_youth             1588.7776   1014.120      1.567      0.117    -398.861    3576.417\n",
       "local_list_share_youth      468.6532   1001.629      0.468      0.640   -1494.504    2431.810\n",
       "share_youth                -168.0637    994.350     -0.169      0.866   -2116.954    1780.827\n",
       "CDU_share_migrants        -3.016e+05    2.1e+04    -14.382      0.000   -3.43e+05    -2.6e+05\n",
       "SPD_share_migrants         -3.61e+05   1.82e+04    -19.789      0.000   -3.97e+05   -3.25e+05\n",
       "Grüne_share_migrants      -3.297e+05   2.11e+04    -15.605      0.000   -3.71e+05   -2.88e+05\n",
       "FW_share_migrants         -3.775e+05   1.75e+04    -21.515      0.000   -4.12e+05   -3.43e+05\n",
       "local_list_share_migrants -3.888e+05   1.73e+04    -22.441      0.000   -4.23e+05   -3.55e+05\n",
       "FDP_share_migrants        -3.975e+05   1.73e+04    -22.949      0.000   -4.31e+05   -3.64e+05\n",
       "Linke_share_migrants       -3.87e+05   1.75e+04    -22.132      0.000   -4.21e+05   -3.53e+05\n",
       "share_migrants               3.4e+05   1.65e+04     20.627      0.000    3.08e+05    3.72e+05\n",
       "share_pupils               4.884e+06   1.91e+05     25.537      0.000    4.51e+06    5.26e+06\n",
       "FW_share_pupils           -4.851e+06    1.9e+05    -25.513      0.000   -5.22e+06   -4.48e+06\n",
       "local_list_share_pupils   -4.736e+06   1.88e+05    -25.144      0.000   -5.11e+06   -4.37e+06\n",
       "CDU_share_pupils          -5.053e+06   1.93e+05    -26.221      0.000   -5.43e+06   -4.68e+06\n",
       "SPD_share_pupils          -4.946e+06    1.9e+05    -26.091      0.000   -5.32e+06   -4.57e+06\n",
       "Grüne_share_pupils         -4.96e+06   1.92e+05    -25.785      0.000   -5.34e+06   -4.58e+06\n",
       "FDP_share_pupils          -4.787e+06   1.88e+05    -25.463      0.000   -5.16e+06   -4.42e+06\n",
       "Linke_share_pupils         -4.77e+06   1.89e+05    -25.283      0.000   -5.14e+06    -4.4e+06\n",
       "==============================================================================\n",
       "Omnibus:                     5076.590   Durbin-Watson:                   0.826\n",
       "Prob(Omnibus):                  0.000   Jarque-Bera (JB):           335346.676\n",
       "Skew:                           2.461   Prob(JB):                         0.00\n",
       "Kurtosis:                      35.019   Cond. No.                     6.07e+10\n",
       "==============================================================================\n",
       "\n",
       "Warnings:\n",
       "[1] Standard Errors are heteroscedasticity robust (HC3)\n",
       "[2] The condition number is large, 6.07e+10. This might indicate that there are\n",
       "strong multicollinearity or other numerical problems.\n",
       "\"\"\""
      ]
     },
     "execution_count": 154,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Check a different program, closer to stata output\n",
    "model = sm.OLS(y, X).fit(cov_type='HC3')\n",
    "predictions = model.predict(X)\n",
    "model.summary()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 142,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(SGDRegressor(alpha=0.0001, average=False, early_stopping=False, epsilon=0.1,\n",
       "        eta0=0.1, fit_intercept=True, l1_ratio=0.15,\n",
       "        learning_rate='invscaling', loss='squared_loss', max_iter=5000,\n",
       "        n_iter=None, n_iter_no_change=5, penalty='l2', power_t=0.25,\n",
       "        random_state=None, shuffle=True, tol=1e-05, validation_fraction=0.1,\n",
       "        verbose=0, warm_start=False),\n",
       " array([-1.34961862e+13, -1.55971653e+15,  1.62506552e+12, -1.70420931e+12,\n",
       "        -7.72745343e+11, -6.64714382e+11,  6.08889431e+13,  8.83404348e+10,\n",
       "         1.43810436e+17, -1.82698863e+12, -3.64504381e+11, -7.07005270e+12,\n",
       "         1.31190113e+11, -5.79556152e+14,  2.15659944e+11,  2.34710066e+11,\n",
       "        -6.52509372e+10, -8.72448305e+09, -1.62554875e+10,  6.47493414e+08,\n",
       "         5.84656391e+12,  3.34969709e+13,  1.19825374e+13, -3.70822352e+12,\n",
       "         2.95893579e+11,  1.31792406e+12, -1.20394644e+12,  7.03558513e+13,\n",
       "        -2.41902698e+13,  1.52236614e+13, -4.79125597e+12, -9.53575821e+12,\n",
       "         2.17196363e+12, -6.98854293e+11, -2.54359453e+11, -3.43407851e+10,\n",
       "         3.42182920e+11,  5.50307602e+10,  6.57590541e+13, -2.26372288e+13,\n",
       "         1.45037731e+13, -3.92629741e+12, -7.45030240e+12,  3.42955127e+13,\n",
       "         3.72260710e+11, -9.71429659e+10,  8.65992800e+09,  3.83705299e+10,\n",
       "        -2.95292060e+10,  1.37101324e+11,  1.58426158e+11,  2.77094683e+11,\n",
       "        -8.35710997e+10,  4.01634649e+10, -6.56052012e+09, -3.70211842e+10]))"
      ]
     },
     "execution_count": 142,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "\"\"\" Now, different approach -> Gradient Descent. \n",
    "    Iterative minimization of a convex cost function\"\"\"\n",
    "\n",
    "sgd_reg = SGDRegressor(max_iter = 5000, penalty = 'l2', eta0 = 0.1, tol = 0.00001)\n",
    "sgd_reg.fit(X, y.ravel()), sgd_reg.coef_"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.1"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
